# 多租戶RBAC系統設計文檔

## 文檔索引

本目錄包含多租戶RBAC系統的完整設計文檔，涵蓋系統架構、數據模型、API設計等各個方面。

## 文檔清單

### 1. [系統架構設計](./01-系統架構設計.md)

- 系統分層架構
- 模塊職責劃分
- 技術棧選擇
- 部署架構
- 擴展性設計

**適用對象**：架構師、技術負責人、開發團隊

### 2. [多租戶隔離策略](./02-多租戶隔離策略.md)

- 租戶識別機制
- 數據隔離策略（行級/Schema級/數據庫級）
- 緩存隔離
- 會話隔離
- 文件存儲隔離
- 性能優化
- 安全加固

**適用對象**：架構師、後端開發、數據庫管理員

### 3. [RBAC模型設計](./03-RBAC模型設計.md)

- RBAC核心概念
- 數據模型設計
- 權限校驗策略
- 預置角色與權限
- 特殊場景處理（臨時授權、權限委派）
- 性能優化建議

**適用對象**：架構師、後端開發、產品經理

### 4. [低耦合設計指南](./04-低耦合設計指南.md)

- SOLID設計原則
- 模塊解耦策略
- 依賴注入
- 事件驅動
- 接口抽象
- 配置外部化
- 重構建議

**適用對象**：開發團隊、技術負責人

### 5. [數據庫設計文檔](./05-數據庫設計文檔.md)

- 數據庫設計原則
- ER圖
- 核心表設計（租戶、用戶、角色、權限、部門）
- 擴展表設計
- 審計日誌表
- 索引優化
- 數據備份策略

**適用對象**：數據庫管理員、後端開發

### 6. [API設計文檔](./06-API設計文檔.md)

- RESTful API規範
- 認證與授權
- 租戶管理API
- 用戶管理API
- 角色管理API
- 權限管理API
- 部門管理API
- 審計日誌API
- 錯誤碼定義

**適用對象**：前端開發、後端開發、測試團隊

## 快速開始

### 對於架構師

建議閱讀順序：

1. 系統架構設計
2. 多租戶隔離策略
3. RBAC模型設計
4. 低耦合設計指南

### 對於後端開發

建議閱讀順序：

1. 系統架構設計
2. RBAC模型設計
3. 數據庫設計文檔
4. API設計文檔
5. 低耦合設計指南

### 對於前端開發

建議閱讀順序：

1. API設計文檔
2. RBAC模型設計（了解權限概念）
3. 系統架構設計（了解整體架構）

### 對於數據庫管理員

建議閱讀順序：

1. 數據庫設計文檔
2. 多租戶隔離策略
3. RBAC模型設計

### 對於測試團隊

建議閱讀順序：

1. API設計文檔
2. RBAC模型設計
3. 系統架構設計

## 項目結構

```
rbac-system-v1/
├── business/                    # 業務模塊
│   ├── auth-module/            # 認證授權模塊
│   ├── user-module/            # 用戶管理模塊
│   ├── permission-module/      # 權限管理模塊
│   ├── tenant-module/          # 租戶管理模塊
│   └── security-defense-module/ # 安全防護模塊
│
├── infrastructure/              # 基礎設施模塊
│   ├── audit-module/           # 審計日誌模塊
│   └── trace-module/           # 鏈路追蹤模塊
│
├── common/                      # 公共模塊
│   ├── common-core/            # 核心工具
│   ├── common-database/        # 數據庫公共組件
│   ├── common-redis/           # Redis公共組件
│   └── common-web/             # Web公共組件
│
└── docs/                        # 文檔目錄（當前）
    ├── README.md               # 本文件
    ├── 01-系統架構設計.md
    ├── 02-多租戶隔離策略.md
    ├── 03-RBAC模型設計.md
    ├── 04-低耦合設計指南.md
    ├── 05-數據庫設計文檔.md
    └── 06-API設計文檔.md
```

## 系統特性

### 核心特性

1. **多租戶支持**
   - 完整的租戶隔離機制
   - 支持行級、Schema級、數據庫級隔離
   - 靈活的租戶配置和管理

2. **RBAC權限模型**
   - 用戶-角色-權限三層模型
   - 支持角色繼承
   - 支持數據權限控制
   - 支持動態權限調整

3. **低耦合架構**
   - 清晰的模塊劃分
   - 依賴注入
   - 事件驅動
   - 接口抽象

4. **高性能**
   - 多級緩存策略
   - 數據庫查詢優化
   - 異步處理
   - 讀寫分離支持

5. **安全性**
   - JWT認證
   - 權限細粒度控制
   - 防暴力破解
   - 審計日誌完整

6. **可擴展性**
   - 支持微服務架構演進
   - 水平擴展能力
   - 插件化設計

## 技術棧

### 後端技術

- **框架**：Spring Boot 2.7+
- **安全**：Spring Security
- **數據庫**：MySQL 8.0+ / PostgreSQL
- **緩存**：Redis
- **ORM**：MyBatis / JPA
- **消息隊列**：RabbitMQ / Kafka（可選）

### 前端技術（建議）

- **框架**：Vue 3 / React
- **UI組件**：Element Plus / Ant Design
- **狀態管理**：Pinia / Redux
- **HTTP客戶端**：Axios

### 開發工具

- **IDE**：IntelliJ IDEA
- **版本控制**：Git
- **API文檔**：Swagger / OpenAPI
- **構建工具**：Maven / Gradle

## 開發規範

### 代碼規範

- 遵循阿里巴巴Java開發手冊
- 使用統一的代碼格式化配置
- 必須編寫單元測試（覆蓋率 > 70%）
- 關鍵業務邏輯必須有集成測試

### 提交規範

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Type類型**：

- `feat`: 新功能
- `fix`: 修復bug
- `docs`: 文檔更新
- `style`: 代碼格式調整
- `refactor`: 重構
- `test`: 測試相關
- `chore`: 構建/工具相關

**示例**：

```
feat(user): 添加用戶批量導入功能

- 支持Excel文件導入
- 支持數據驗證
- 支持錯誤報告

Closes #123
```

### 分支策略

```
main          # 主分支，穩定版本
  ├─ develop  # 開發分支
  │   ├─ feature/xxx  # 功能分支
  │   ├─ fix/xxx      # 修復分支
  │   └─ refactor/xxx # 重構分支
  └─ release/x.x.x    # 發布分支
```

## 部署說明

### 開發環境

```bash
# 1. 啟動MySQL
docker run -d --name mysql -p 3306:3306 \
  -e MYSQL_ROOT_PASSWORD=root \
  mysql:8.0

# 2. 啟動Redis
docker run -d --name redis -p 6379:6379 redis:7

# 3. 創建數據庫
mysql -u root -p < docs/sql/schema.sql

# 4. 運行應用
mvn spring-boot:run
```

### 生產環境

詳見運維文檔（待補充）

## 監控與運維

### 健康檢查

```
GET /actuator/health
```

### 性能指標

```
GET /actuator/metrics
```

### 日誌查看

日誌存儲路徑：`/var/log/rbac-system/`

## 常見問題

### Q1: 如何切換租戶隔離策略？

A: 修改配置文件中的 `tenant.isolation.strategy` 參數，支持 `ROW`、`SCHEMA`、`DATABASE` 三種模式。

### Q2: 如何添加新的權限？

A: 在 `sys_permission` 表中插入新的權限記錄，並通過角色管理界面分配給相應角色。

### Q3: 如何實現自定義數據權限？

A: 繼承 `DataScope` 接口，實現自定義的數據過濾邏輯。

### Q4: 如何進行性能優化？

A: 參考 `02-多租戶隔離策略.md` 第10章「性能優化」和 `05-數據庫設計文檔.md` 第9章「數據庫優化建議」。

## 貢獻指南

歡迎提交Issue和Pull Request！

1. Fork本項目
2. 創建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'feat: Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 創建Pull Request

## 版本歷史

- v1.0.0 (2025-11-21)
  - 初始版本
  - 完整的設計文檔
  - 核心功能規劃

## 聯繫方式

- **項目負責人**：[待定]
- **郵箱**：[待定]
- **文檔維護**：開發團隊

## 許可證

[待定]

---

**最後更新**：2025年11月21日

**文檔版本**：v1.0.0
